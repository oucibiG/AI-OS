<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† AI Task Manager</title>
    
    <!-- AI-OS Core Integration -->
    <script src="../js/ai-os-core.js"></script>
    <script src="../js/ai-os-app-integration.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            background: #000;
            color: #00ff00;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-image: 
                linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .task-manager {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .tm-header {
            height: 60px;
            background: #000;
            border-bottom: 2px solid #00ff00;
            border-top: 1px solid #00ff00;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .tm-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff00;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .tm-controls {
            display: flex;
            gap: 10px;
        }
        
        .tm-btn {
            padding: 8px 16px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            color: #00d4ff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tm-btn:hover {
            background: rgba(0, 212, 255, 0.2);
        }
        
        .tm-btn.danger {
            border-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }
        
        .tm-btn.danger:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        
        .tm-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .tm-sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-right: 1px solid rgba(0, 212, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .tm-sidebar.hidden {
            transform: translateX(-100%);
            width: 0;
            padding: 0;
            border: none;
        }
        
        .tm-toggle-sidebar {
            position: absolute;
            top: 70px;
            left: 260px;
            width: 30px;
            height: 30px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .tm-toggle-sidebar:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }
        
        .tm-toggle-sidebar.hidden {
            left: 10px;
        }
        
        .tm-toggle-icon {
            color: #00d4ff;
            font-size: 14px;
            transition: transform 0.3s ease;
        }
        
        .tm-toggle-sidebar.hidden .tm-toggle-icon {
            transform: rotate(180deg);
        }
        
        .tm-section {
            margin-bottom: 30px;
        }
        
        .tm-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tm-metric {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .tm-metric-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .tm-metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #00d4ff;
        }
        
        .tm-metric-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .tm-metric-progress {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #0099cc);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .tm-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .tm-processes {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .tm-processes-header {
            background: rgba(0, 212, 255, 0.1);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tm-processes-count {
            font-size: 14px;
            color: #00d4ff;
        }
        
        .tm-processes-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tm-process {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.3s ease;
        }
        
        .tm-process:hover {
            background: rgba(0, 212, 255, 0.05);
        }
        
        .tm-process:last-child {
            border-bottom: none;
        }
        
        .tm-process-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: rgba(0, 212, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
        }
        
        .tm-process-info {
            flex: 1;
        }
        
        .tm-process-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .tm-process-status {
            font-size: 12px;
            color: #888;
        }
        
        .tm-process-stats {
            display: flex;
            gap: 20px;
            font-size: 12px;
        }
        
        .tm-process-stat {
            color: #888;
        }
        
        .tm-process-stat-value {
            color: #00d4ff;
            font-weight: 600;
        }
        
        .tm-process-actions {
            display: flex;
            gap: 8px;
        }
        
        .tm-process-btn {
            padding: 4px 8px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 4px;
            color: #00d4ff;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tm-process-btn:hover {
            background: rgba(0, 212, 255, 0.2);
        }
        
        .tm-process-btn.danger {
            border-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }
        
        .tm-search {
            width: 100%;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .tm-search::placeholder {
            color: #888;
        }
        
        .tm-search:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }
        
        .tm-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .tm-chart {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .tm-chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 15px;
        }
        
        .tm-chart-canvas {
            width: 100%;
            height: 150px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .tm-filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tm-tab {
            padding: 8px 16px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            color: #00d4ff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tm-tab.active,
        .tm-tab:hover {
            background: rgba(0, 212, 255, 0.2);
        }
        
        .tm-ai-section {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .tm-ai-title {
            font-size: 16px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tm-ai-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .tm-ai-recommendation {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .tm-ai-recommendation:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
        }
        
        .tm-ai-recommendation-title {
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 8px;
        }
        
        .tm-ai-recommendation-desc {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .tm-ai-recommendation-action {
            padding: 6px 12px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            border-radius: 4px;
            color: #00d4ff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tm-ai-recommendation-action:hover {
            background: rgba(0, 212, 255, 0.2);
        }
        
        .status-running { color: #2ecc71; }
        .status-sleeping { color: #f39c12; }
        .status-stopped { color: #e74c3c; }
        .status-zombie { color: #9b59b6; }
    
        /* Floating Home Button */
        .floating-home-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 255, 0, 0.3);
            border: 2px solid #00ff88;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            animation: homePulse 2s infinite;
        }

        .floating-home-btn:hover {
            background: rgba(0, 255, 0, 0.5);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.7);
            animation: none;
        }

        @keyframes homePulse {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 0, 0.3); }
            50% { box-shadow: 0 0 15px rgba(0, 255, 0, 0.6); }
        }
    </style>
</head>
<body>
    <!-- Floating Home Button -->
    <div class="floating-home-btn" onclick="goHome()" title="Domov">üè†</div>
    <div class="task-manager">
        <!-- Header -->
        <div class="tm-header">
            <div class="tm-title">
                <span>üß†</span>
                <span>AI Task Manager</span>
            </div>
            <div class="tm-controls">
                <button class="tm-btn" onclick="refreshProcesses()">üîÑ Refresh</button>
                <button class="tm-btn" onclick="endAllProcesses()">üõë End All</button>
                <button class="tm-btn" onclick="launchPerformanceMonitor()">üìä Monitor</button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="tm-main">
            <!-- Sidebar -->
            <div class="tm-sidebar">
                <div class="tm-section">
                    <div class="tm-section-title">
                        <span>üìä</span>
                        <span>System Metrics</span>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">CPU Usage</div>
                        <div class="tm-metric-value" id="cpuUsage">23%</div>
                        <div class="tm-metric-bar">
                            <div class="tm-metric-progress" id="cpuProgress" style="width: 23%"></div>
                        </div>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">Memory Usage</div>
                        <div class="tm-metric-value" id="memoryUsage">4.2GB / 8GB</div>
                        <div class="tm-metric-bar">
                            <div class="tm-metric-progress" id="memoryProgress" style="width: 52%"></div>
                        </div>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">Disk Usage</div>
                        <div class="tm-metric-value" id="diskUsage">156GB / 500GB</div>
                        <div class="tm-metric-bar">
                            <div class="tm-metric-progress" id="diskProgress" style="width: 31%"></div>
                        </div>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">Network</div>
                        <div class="tm-metric-value" id="networkUsage">‚Üë 1.2MB/s ‚Üì 800KB/s</div>
                    </div>
                </div>
                
                <div class="tm-section">
                    <div class="tm-section-title">
                        <span>ü§ñ</span>
                        <span>AI Optimization</span>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">AI Efficiency</div>
                        <div class="tm-metric-value">87%</div>
                        <div class="tm-metric-bar">
                            <div class="tm-metric-progress" style="width: 87%"></div>
                        </div>
                    </div>
                    
                    <div class="tm-metric">
                        <div class="tm-metric-label">Process Optimization</div>
                        <div class="tm-metric-value">92%</div>
                        <div class="tm-metric-bar">
                            <div class="tm-metric-progress" style="width: 92%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Toggle Sidebar Button -->
            <div class="tm-toggle-sidebar" onclick="toggleSidebar()" title="Toggle Sidebar">
                <span class="tm-toggle-icon">‚óÄ</span>
            </div>
            
            <!-- Content Area -->
            <div class="tm-content">
                <div class="tm-search">
                    <input type="text" placeholder="üîç Search processes..." onkeyup="filterProcesses(this.value)">
                </div>
                
                <div class="tm-filter-tabs">
                    <div class="tm-tab active" onclick="filterByStatus('all')">All Processes</div>
                    <div class="tm-tab" onclick="filterByStatus('running')">Running</div>
                    <div class="tm-tab" onclick="filterByStatus('sleeping')">Sleeping</div>
                    <div class="tm-tab" onclick="filterByStatus('ai-managed')">AI Managed</div>
                </div>
                
                <div class="tm-ai-section">
                    <div class="tm-ai-title">
                        <span>ü§ñ</span>
                        <span>AI Performance Recommendations</span>
                    </div>
                    <div class="tm-ai-recommendations" id="aiRecommendations">
                        <!-- AI recommendations will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="tm-processes">
                    <div class="tm-processes-header">
                        <div class="tm-processes-count" id="processesCount">12 processes running</div>
                        <div class="tm-controls">
                            <button class="tm-btn" onclick="startNewProcess()">‚ûï New Process</button>
                        </div>
                    </div>
                    <div class="tm-processes-list" id="processesList">
                        <!-- Processes will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="tm-charts">
                    <div class="tm-chart">
                        <div class="tm-chart-title">CPU Usage Over Time</div>
                        <canvas class="tm-chart-canvas" id="cpuChart"></canvas>
                    </div>
                    <div class="tm-chart">
                        <div class="tm-chart-title">Memory Usage Over Time</div>
                        <canvas class="tm-chart-canvas" id="memoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AITaskManager {
            constructor() {
                this.processes = [];
                this.currentFilter = 'all';
                this.aiRecommendations = [];
                this.updateInterval = null;
                this.cpuHistory = [];
                this.memoryHistory = [];
                
                this.init();
            }
            
            init() {
                this.generateProcesses();
                this.generateAIRecommendations();
                this.renderProcesses();
                this.renderRecommendations();
                this.startMonitoring();
                this.setupCharts();
            }
            
            generateProcesses() {
                this.processes = [
                    {
                        id: 1,
                        name: 'AI Kernel Core',
                        icon: 'üß†',
                        status: 'running',
                        cpu: 15.2,
                        memory: 180,
                        priority: 'high',
                        aiManaged: true
                    },
                    {
                        id: 2,
                        name: 'Desktop Interface',
                        icon: 'üñ•Ô∏è',
                        status: 'running',
                        cpu: 8.5,
                        memory: 120,
                        priority: 'medium',
                        aiManaged: true
                    },
                    {
                        id: 3,
                        name: 'System Settings',
                        icon: '‚öôÔ∏è',
                        status: 'running',
                        cpu: 2.1,
                        memory: 45,
                        priority: 'low',
                        aiManaged: false
                    },
                    {
                        id: 4,
                        name: 'App Store',
                        icon: 'üè™',
                        status: 'running',
                        cpu: 3.8,
                        memory: 95,
                        priority: 'medium',
                        aiManaged: true
                    },
                    {
                        id: 5,
                        name: 'Mobile Interface',
                        icon: 'üì±',
                        status: 'sleeping',
                        cpu: 0.5,
                        memory: 25,
                        priority: 'low',
                        aiManaged: false
                    },
                    {
                        id: 6,
                        name: 'Process Manager',
                        icon: 'üß†',
                        status: 'running',
                        cpu: 4.2,
                        memory: 67,
                        priority: 'high',
                        aiManaged: true
                    },
                    {
                        id: 7,
                        name: 'File Manager',
                        icon: 'üìÅ',
                        status: 'running',
                        cpu: 1.8,
                        memory: 35,
                        priority: 'medium',
                        aiManaged: false
                    },
                    {
                        id: 8,
                        name: 'Network Monitor',
                        icon: 'üåê',
                        status: 'running',
                        cpu: 2.5,
                        memory: 42,
                        priority: 'medium',
                        aiManaged: true
                    },
                    {
                        id: 9,
                        name: 'Security Center',
                        icon: 'üõ°Ô∏è',
                        status: 'running',
                        cpu: 1.2,
                        memory: 28,
                        priority: 'high',
                        aiManaged: true
                    },
                    {
                        id: name: 'UI 10,
                        Framework',
                        icon: 'üé®',
                        status: 'running',
                        cpu: 3.1,
                        memory: 58,
                        priority: 'high',
                        aiManaged: true
                    },
                    {
                        id: 11,
                        name: 'Database Engine',
                        icon: 'üóÑÔ∏è',
                        status: 'running',
                        cpu: 5.7,
                        memory: 145,
                        priority: 'high',
                        aiManaged: true
                    },
                    {
                        id: 12,
                        name: 'Learning Engine',
                        icon: 'üìö',
                        status: 'running',
                        cpu: 7.3,
                        memory: 89,
                        priority: 'medium',
                        aiManaged: true
                    }
                ];
            }
            
            generateAIRecommendations() {
                this.aiRecommendations = [
                    {
                        title: 'Optimize Memory Usage',
                        description: 'AI detected that Database Engine can be optimized for 15% memory savings',
                        action: 'Optimize',
                        priority: 'high'
                    },
                    {
                        title: 'CPU Load Balancing',
                        description: 'Distribute high-CPU processes across available cores',
                        action: 'Balance',
                        priority: 'medium'
                    },
                    {
                        title: 'Background Process Optimization',
                        description: '5 sleeping processes can be safely terminated to free resources',
                        action: 'Clean Up',
                        priority: 'low'
                    },
                    {
                        title: 'AI Efficiency Boost',
                        description: 'Enable AI predictive caching for 20% performance improvement',
                        action: 'Enable',
                        priority: 'high'
                    }
                ];
            }
            
            renderProcesses() {
                const container = document.getElementById('processesList');
                const filtered = this.getFilteredProcesses();
                
                container.innerHTML = filtered.map(process => `
                    <div class="tm-process" data-status="${process.status}" data-ai="${process.aiManaged}">
                        <div class="tm-process-icon">${process.icon}</div>
                        <div class="tm-process-info">
                            <div class="tm-process-name">${process.name}</div>
                            <div class="tm-process-status status-${process.status}">
                                ${process.status.charAt(0).toUpperCase() + process.status.slice(1)}
                                ${process.aiManaged ? ' ‚Ä¢ AI Managed' : ''}
                            </div>
                        </div>
                        <div class="tm-process-stats">
                            <div class="tm-process-stat">
                                CPU: <span class="tm-process-stat-value">${process.cpu}%</span>
                            </div>
                            <div class="tm-process-stat">
                                Memory: <span class="tm-process-stat-value">${process.memory}MB</span>
                            </div>
                            <div class="tm-process-stat">
                                Priority: <span class="tm-process-stat-value">${process.priority}</span>
                            </div>
                        </div>
                        <div class="tm-process-actions">
                            <button class="tm-process-btn" onclick="pauseProcess(${process.id})">‚è∏Ô∏è</button>
                            <button class="tm-process-btn" onclick="restartProcess(${process.id})">üîÑ</button>
                            <button class="tm-process-btn danger" onclick="killProcess(${process.id})">üõë</button>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('processesCount').textContent = 
                    `${filtered.length} processes running`;
            }
            
            renderRecommendations() {
                const container = document.getElementById('aiRecommendations');
                container.innerHTML = this.aiRecommendations.map(rec => `
                    <div class="tm-ai-recommendation">
                        <div class="tm-ai-recommendation-title">${rec.title}</div>
                        <div class="tm-ai-recommendation-desc">${rec.description}</div>
                        <button class="tm-ai-recommendation-action" onclick="executeRecommendation('${rec.title}')">
                            ${rec.action}
                        </button>
                    </div>
                `).join('');
            }
            
            getFilteredProcesses() {
                let filtered = this.processes;
                
                if (this.currentFilter !== 'all') {
                    if (this.currentFilter === 'ai-managed') {
                        filtered = this.processes.filter(p => p.aiManaged);
                    } else {
                        filtered = this.processes.filter(p => p.status === this.currentFilter);
                    }
                }
                
                return filtered;
            }
            
            updateMetrics() {
                // Simulate real-time metric updates
                const cpuUsage = Math.floor(Math.random() * 30 + 15);
                const memoryUsage = Math.floor(Math.random() * 20 + 40);
                const diskUsage = Math.floor(Math.random() * 15 + 60);
                
                document.getElementById('cpuUsage').textContent = `${cpuUsage}%`;
                document.getElementById('cpuProgress').style.width = `${cpuUsage}%`;
                
                document.getElementById('memoryUsage').textContent = `${(memoryUsage * 0.08).toFixed(1)}GB / 8GB`;
                document.getElementById('memoryProgress').style.width = `${memoryUsage}%`;
                
                document.getElementById('diskUsage').textContent = `${(diskUsage * 5).toFixed(0)}GB / 500GB`;
                document.getElementById('diskProgress').style.width = `${diskUsage}%`;
                
                const upload = (Math.random() * 2).toFixed(1);
                const download = (Math.random() * 1.5).toFixed(1);
                document.getElementById('networkUsage').textContent = 
                    `‚Üë ${upload}MB/s ‚Üì ${download}MB/s`;
                
                // Update process metrics slightly
                this.processes.forEach(process => {
                    process.cpu += (Math.random() - 0.5) * 2;
                    process.cpu = Math.max(0, Math.min(100, process.cpu));
                    process.memory += (Math.random() - 0.5) * 10;
                    process.memory = Math.max(10, process.memory);
                });
                
                // Update charts
                this.updateCharts();
            }
            
            setupCharts() {
                // Initialize chart canvases
                const cpuCanvas = document.getElementById('cpuChart');
                const memoryCanvas = document.getElementById('memoryChart');
                
                // Set up 2D context for simple charts
                if (cpuCanvas && cpuCanvas.getContext) {
                    this.cpuChart = cpuCanvas.getContext('2d');
                }
                if (memoryCanvas && memoryCanvas.getContext) {
                    this.memoryChart = memoryCanvas.getContext('2d');
                }
            }
            
            updateCharts() {
                // Simple line chart simulation
                if (this.cpuChart) {
                    this.cpuHistory.push(parseInt(document.getElementById('cpuUsage').textContent));
                    if (this.cpuHistory.length > 20) this.cpuHistory.shift();
                    this.drawChart(this.cpuChart, this.cpuHistory, '#00d4ff');
                }
                
                if (this.memoryChart) {
                    this.memoryHistory.push(parseInt(document.getElementById('memoryProgress').style.width));
                    if (this.memoryHistory.length > 20) this.memoryHistory.shift();
                    this.drawChart(this.memoryChart, this.memoryHistory, '#0099cc');
                }
            }
            
            drawChart(ctx, data, color) {
                if (!ctx || data.length < 2) return;
                
                const canvas = ctx.canvas;
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.clearRect(0, 0, width, height);
                
                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                
                data.forEach((value, index) => {
                    const x = (index / (data.length - 1)) * width;
                    const y = height - (value / 100) * height;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            }
            
            startMonitoring() {
                this.updateMetrics();
                this.renderProcesses();
                
                this.updateInterval = setInterval(() => {
                    this.updateMetrics();
                    this.renderProcesses();
                }, 2000);
            }
            
            stopMonitoring() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            }
        }
        
        // Global functions
        let taskManager;
        let sidebarVisible = true;
        
        function toggleSidebar() {
            const sidebar = document.querySelector('.tm-sidebar');
            const toggleBtn = document.querySelector('.tm-toggle-sidebar');
            const toggleIcon = document.querySelector('.tm-toggle-icon');
            
            sidebarVisible = !sidebarVisible;
            
            if (sidebarVisible) {
                sidebar.classList.remove('hidden');
                toggleBtn.classList.remove('hidden');
                toggleIcon.textContent = '‚óÄ';
            } else {
                sidebar.classList.add('hidden');
                toggleBtn.classList.add('hidden');
                toggleIcon.textContent = '‚ñ∂';
            }
        }
        
        function refreshProcesses() {
            taskManager.renderProcesses();
            showNotification('Task Manager', 'Processes refreshed');
        }
        
        function filterProcesses(searchTerm) {
            const processes = document.querySelectorAll('.tm-process');
            processes.forEach(process => {
                const name = process.querySelector('.tm-process-name').textContent.toLowerCase();
                process.style.display = name.includes(searchTerm.toLowerCase()) ? 'flex' : 'none';
            });
        }
        
        function filterByStatus(status) {
            taskManager.currentFilter = status;
            
            // Update tab states
            document.querySelectorAll('.tm-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            taskManager.renderProcesses();
        }
        
        function pauseProcess(processId) {
            const process = taskManager.processes.find(p => p.id === processId);
            if (process) {
                process.status = process.status === 'running' ? 'sleeping' : 'running';
                taskManager.renderProcesses();
                showNotification('Task Manager', `${process.name} ${process.status}`);
            }
        }
        
        function restartProcess(processId) {
            const process = taskManager.processes.find(p => p.id === processId);
            if (process) {
                process.status = 'running';
                process.cpu = Math.random() * 10 + 5;
                taskManager.renderProcesses();
                showNotification('Task Manager', `${process.name} restarted`);
            }
        }
        
        function killProcess(processId) {
            const process = taskManager.processes.find(p => p.id === processId);
            if (process && confirm(`Terminate ${process.name}?`)) {
                taskManager.processes = taskManager.processes.filter(p => p.id !== processId);
                taskManager.renderProcesses();
                showNotification('Task Manager', `${process.name} terminated`);
            }
        }
        
        function endAllProcesses() {
            if (confirm('Terminate all processes?')) {
                taskManager.processes = taskManager.processes.filter(p => p.aiManaged);
                taskManager.renderProcesses();
                showNotification('Task Manager', 'Non-AI processes terminated');
            }
        }
        
        function startNewProcess() {
            const name = prompt('Enter process name:');
            if (name) {
                const newProcess = {
                    id: Date.now(),
                    name: name,
                    icon: 'üîß',
                    status: 'running',
                    cpu: Math.random() * 5 + 1,
                    memory: Math.random() * 50 + 10,
                    priority: 'medium',
                    aiManaged: false
                };
                taskManager.processes.push(newProcess);
                taskManager.renderProcesses();
                showNotification('Task Manager', `${name} started`);
            }
        }
        
        function launchPerformanceMonitor() {
            // Open performance monitor in new window or tab
            window.open('ai-system-monitor.html', '_blank');
        }
        
        function executeRecommendation(title) {
            showNotification('AI Task Manager', `Executing: ${title}`);
            // Simulate execution
            setTimeout(() => {
                showNotification('AI Task Manager', `${title} completed successfully`);
            }, 2000);
        }
        
        function showNotification(title, message) {
            // Simple notification system
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: rgba(0, 212, 255, 0.1);
                border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 8px; padding: 15px;
                color: white; z-index: 10000; min-width: 250px;
            `;
            notification.innerHTML = `<div style="font-weight: 600; color: #00d4ff;">${title}</div><div>${message}</div>`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // AI-OS Core Integration
        let aiOSIntegration = null;
        
        function handleAIOSCommand(command) {
            if (taskManager) {
                switch (command.action) {
                    case 'refreshTasks':
                        taskManager.refreshTaskList();
                        break;
                    case 'killProcess':
                        taskManager.killProcess(command.pid);
                        break;
                    case 'startProcess':
                        taskManager.startProcess(command.name, command.args);
                        break;
                    case 'showPerformance':
                        taskManager.showPerformanceMonitor();
                        break;
                    case 'optimizeSystem':
                        taskManager.optimizeSystem();
                        break;
                    default:
                        console.log('Unknown AI-OS command:', command);
                }
            }
        }
        
        function updateTaskManagerStatus(systemState) {
            // Update task manager with system information
            if (taskManager && systemState) {
                // Update CPU and memory information
                if (systemState.cpu !== undefined || systemState.memory !== undefined) {
                    console.log('üß† Task Manager system status updated');
                }
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß† Initializing AI Task Manager...');
            
            // Wait for AI-OS Core to be available
            const initTaskManager = () => {
                taskManager = new AITaskManager();
                
                // Setup AI-OS Core integration
                if (window.aiOSCore && window.AIOSAppIntegration) {
                    aiOSIntegration = new AIOSAppIntegration('task-manager', 'AI Task Manager', [
                        'process_management', 'performance_monitoring', 'system_optimization', 'resource_tracking'
                    ]);
                    
                    // Listen for AI-OS events
                    aiOSIntegration.on('appMessage', (data) => {
                        if (data.from === 'aiOS-core') {
                            handleAIOSCommand(data.data);
                        }
                    });
                    
                    aiOSIntegration.on('systemStateUpdate', (data) => {
                        updateTaskManagerStatus(data);
                    });
                    
                    console.log('‚úÖ Task Manager integrated with AI-OS Core');
                }
            };
            
            if (window.aiOSCore) {
                initTaskManager();
            } else {
                setTimeout(initTaskManager, 1000);
            }
        });
    
        function goHome() {
            // Create smooth transition effect
            const container = document.querySelector('.app-container, .main-container, body > div, body');
            if (container) {
                container.style.opacity = '0';
                container.style.transform = 'scale(0.9)';
            }
            
            setTimeout(() => {
                // Navigate back to main AI-OS
                if (window.opener) {
                    window.close();
                } else {
                    const basePath = window.location.pathname.includes('/Apps/') ? '../' : '../../';
                    window.location.href = basePath + 'ADVANCED-AI-OS.html';
                }
            }, 300);
        }
    </script>
</body>
</html>